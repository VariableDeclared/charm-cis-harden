# Copyright 2024 Canonical, Ltd.
# See LICENSE file for licensing details.
name: charm-cis-hardening
type: charm
title: Charm Template
subordinate: true
summary: A charm to perform CIS hardening with usg on the machine it runs on.
description: |
  A charm to enable per-application CIS hardening
links:
  contact: https://launchpad.net/~pjds
  documentation: https://discourse.charmhub.io/t/keystone-k8s-auth/14554
  issues:
  - https://github.com/VariableDeclared/charm-cis-harden/issues
  source:
  - https://github.com/VariableDeclared/charm-cis-harden/

# (Required for 'charm' type)
# A list of environments (OS version and architecture) where charms must be
# built on and run on.
bases:
  - build-on:
    - name: ubuntu
      channel: "22.04"
    run-on:
    - name: ubuntu
      channel: "22.04"
    - name: ubuntu
      channel: "24.04"

requires:
  juju-info:
    description: |
      Pair with parent application
    interface: juju-info
    scope: container
# (Optional) Configuration options for the charm
# This config section defines charm config options, and populates the Configure
# tab on Charmhub.
# More information on this section at https://juju.is/docs/sdk/charmcraft-yaml#heading--config
# General configuration documentation: https://juju.is/docs/sdk/config
config:
  options:
    # An example config option to customise the log level of the workload
    auto-harden:
      description: |
        Whether to start CIS hardening as soon as the charm passes the install hook.
        Defaults to false
      default: false
      type: boolean
    tailoring-file:
      description: |
        The XML file in base64 to apply to the application.
      type: string
      default: ""

actions:
  execute-cis:
    description: Start the CIS benchmark.
  execute-audit:
    description: Run audit with the tailoring file
